/* ============================================
   VIDEO MASK - Portal overlay with state machine
   ============================================

   States: cold, warm, hot (controlled via PortalState)

   CSS Custom Properties:
   --mask-size: portal radius in px
   --mask-aspect: width/height ratio (0.8 = tall oval)
   --mask-cy: vertical center position
   --mask-feather: edge softness
   --mask-duration: animation duration
   --ring-width/height: glow ring dimensions
   --pulse-offset: breathing animation offset

   JS API: window.PortalState, window.VideoMask
   ============================================ */

/* ============================================
   CUSTOM PROPERTY REGISTRATION
   ============================================ */

@property --mask-size {
  syntax: '<length>';
  inherits: true;
  initial-value: 0px;
}

@property --pulse-offset {
  syntax: '<length>';
  inherits: true;
  initial-value: 0px;
}

@property --mask-cy {
  syntax: '<percentage>';
  inherits: true;
  initial-value: 50%;
}


@property --glow-angle {
  syntax: '<angle>';
  inherits: false;
  initial-value: 0deg;
}

@property --glow-angle-slow {
  syntax: '<angle>';
  inherits: false;
  initial-value: 0deg;
}

/* ============================================
   PORTAL BACKGROUNDS - State visibility
   ============================================ */

/* Permanent base layer that never fades */
.video-container-inner::after {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: #020617;
  z-index: 0;
}

/* All backgrounds always visible - use opacity for transitions */
.portal-background {
  opacity: 1;
  transition: opacity 1s ease-out;
}

/* Cold state transitions */
.portal-background-cold {
  z-index: 10;
}

.portal-background-cold:not(.active) {
  opacity: 0;
  transition: opacity 1.2s ease-in;
}

.portal-background-cold::before,
.portal-background-cold::after,
.portal-background-cold .grid-scanlines {
  transition: opacity 1.2s ease-in, transform 1.2s ease-in;
}

.portal-background-cold:not(.active)::before,
.portal-background-cold:not(.active) .grid-scanlines {
  opacity: 0;
  transform: translate(-50%, -50%) perspective(500px) rotateX(60deg) scale(2);
}

.portal-background-cold:not(.active)::after {
  opacity: 0;
}

/* Warm state transitions */
.portal-background-warm {
  z-index: 20;
  opacity: 0;
  transform: scale(0.9);
}

.portal-background-warm.active {
  opacity: 1;
  transform: scale(1);
  transition: opacity 1s ease-out 0.2s, transform 1s ease-out 0.2s;
}

.portal-background-warm .tunnel-rings,
.portal-background-warm .warp-center,
.portal-background-warm .streak {
  transition: opacity 0.8s ease-out;
}

.portal-background-warm:not(.active) .tunnel-rings,
.portal-background-warm:not(.active) .warp-center,
.portal-background-warm:not(.active) .streak {
  opacity: 0 !important;
}

/* Warm fading out */
.portal-background-warm:not(.active) {
  opacity: 0;
  transform: scale(1.1);
  transition: opacity 0.8s ease-in, transform 0.8s ease-in;
}

/* Hot state transitions */
.portal-background-hot {
  z-index: 30;
  opacity: 0;
}

.portal-background-hot.active {
  opacity: 1;
  transition: opacity 0.5s ease-out;
}

.portal-background-hot::before {
  transition: opacity 0.3s ease-out;
}

.portal-background-hot:not(.active)::before {
  opacity: 0;
}

/* Hide video/canvas until connected */
.video-container video,
.video-container .streaming-frame {
  position: relative;
  z-index: 40;
  opacity: 0;
  transition: opacity 0.3s ease;
  background: #020617;
}

/* Only show video/canvas after expansion animation completes */
.video-container.expanded video,
.video-container.expanded .streaming-frame {
  opacity: 1;
}

/* ============================================
   BASE PORTAL STYLES
   ============================================ */

.video-mask {
  --mask-size: 28cqh; /* ~100px at 360px height */
  --mask-cx: 50%;
  --mask-cy: 50%;
  --mask-feather: 2.8cqh; /* ~10px at 360px height */
  --mask-duration: 1.2s;
  --mask-aspect: 0.8;
  --pulse-offset: 0px;

  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  z-index: 50;
  pointer-events: none;
  overflow: hidden;
  background: radial-gradient(
    ellipse calc((var(--mask-size) + var(--pulse-offset)) * var(--mask-aspect)) calc(var(--mask-size) + var(--pulse-offset)) at var(--mask-cx) var(--mask-cy),
    transparent 0%,
    transparent 85%,
    rgba(80, 200, 220, 0.15) 90%,
    rgba(80, 200, 220, 0.3) 95%,
    #020617 100%
  );
  transition: none;
}

/* Slow rotating glow layer - derives size from mask aperture */
.video-mask::before {
  content: '';
  position: absolute;
  pointer-events: none;
  /* Ring sized relative to mask aperture: ~2.4x mask size for softer spread */
  width: calc((var(--mask-size) + var(--pulse-offset)) * var(--mask-aspect) * 2.4);
  height: calc((var(--mask-size) + var(--pulse-offset)) * 2.4);
  left: 50%;
  top: var(--mask-cy);
  transform: translate(-50%, -50%);
  border-radius: 50%;
  /* Slow rotating highlights - wider, softer bands */
  background: conic-gradient(
    from var(--glow-angle-slow, 0deg),
    transparent 0deg,
    rgba(80, 180, 220, 0.4) 40deg,
    rgba(120, 140, 255, 0.3) 80deg,
    transparent 120deg,
    transparent 200deg,
    rgba(160, 100, 220, 0.25) 240deg,
    rgba(80, 200, 200, 0.3) 280deg,
    transparent 320deg,
    transparent 360deg
  );
  /* Mask to ring shape */
  -webkit-mask: radial-gradient(
    ellipse 50% 50% at center,
    transparent 68%,
    white 80%,
    white 90%,
    transparent 100%
  );
  mask: radial-gradient(
    ellipse 50% 50% at center,
    transparent 68%,
    white 80%,
    white 90%,
    transparent 100%
  );
  filter: blur(8px);
  opacity: 0;
  /* No transition by default - instant resize with container units */
  transition: none;
}

/* Rotating highlight - travels along portal circumference */
.video-mask::after {
  content: '';
  position: absolute;
  pointer-events: none;
  width: calc((var(--mask-size) + var(--pulse-offset)) * var(--mask-aspect) * 2.4);
  height: calc((var(--mask-size) + var(--pulse-offset)) * 2.4);
  left: 50%;
  top: var(--mask-cy);
  transform: translate(-50%, -50%);
  border-radius: 50%;
  /* Concentrated bright spot that rotates around the ring */
  background: conic-gradient(
    from var(--glow-angle, 0deg),
    transparent 0deg,
    rgba(0, 220, 255, 0.7) 15deg,
    rgba(180, 80, 255, 0.6) 30deg,
    transparent 60deg,
    transparent 180deg,
    rgba(0, 255, 200, 0.5) 200deg,
    rgba(100, 140, 255, 0.4) 220deg,
    transparent 250deg,
    transparent 360deg
  );
  /* Mask to ring shape - tight band at the edge */
  -webkit-mask: radial-gradient(
    ellipse 50% 50% at center,
    transparent 72%,
    white 82%,
    white 88%,
    transparent 96%
  );
  mask: radial-gradient(
    ellipse 50% 50% at center,
    transparent 72%,
    white 82%,
    white 88%,
    transparent 96%
  );
  filter: blur(4px);
  opacity: 0;
  transition: none;
}

/* ============================================
   ANIMATION KEYFRAMES
   ============================================ */

@keyframes portalRingColorShift {
  from { --glow-angle: 0deg; }
  to { --glow-angle: 360deg; }
}

@keyframes portalRingColorShiftSlow {
  from { --glow-angle-slow: 0deg; }
  to { --glow-angle-slow: 360deg; }
}

@keyframes portalHeartbeat {
  0%, 20%, 100% { --pulse-offset: 0px; }
  5% { --pulse-offset: 4px; }
  10% { --pulse-offset: 0px; }
  15% { --pulse-offset: 2px; }
}

/* Shudder effect for coldâ†’warm transition */
@keyframes portalShudder {
  0% { --pulse-offset: 0px; }
  15% { --pulse-offset: -5px; }
  30% { --pulse-offset: 3px; }
  45% { --pulse-offset: -2px; }
  60% { --pulse-offset: 1px; }
  80% { --pulse-offset: 0px; }
  100% { --pulse-offset: 0px; }
}

@keyframes portalColdIdle {
  0%, 100% {
    --pulse-offset: 0px;
    --mask-cy: 50%;
  }
  50% {
    --pulse-offset: 3px;
    --mask-cy: 49.5%;
  }
}

@keyframes portalWarmIdle {
  0%, 100% { --pulse-offset: 0px; }
  50% { --pulse-offset: 2px; }
}

/* ============================================
   ANIMATION STATES
   ============================================ */

/* Transitioning state - disable idle animations and hide ring */
.video-mask.animating {
  animation: none;
  transition: --mask-size var(--mask-duration) cubic-bezier(0.4, 0, 0.2, 1);
}


/* Hide glow ring when expanded (video fully visible) */
.video-mask.expanded::before,
.video-mask.expanded::after {
  animation: none !important;
  opacity: 0 !important;
}

/* Keep ring visible during shrinking - animate with the mask */
.video-mask.shrinking::before {
  opacity: 0.5;
  animation: portalRingColorShiftSlow 5s linear infinite;
}

.video-mask.shrinking::after {
  opacity: 0.4;
  animation: portalRingColorShift 1.5s linear infinite;
}

/* Hide ring during expansion (after shrink, before expanded) */
.video-mask.animating:not(.shrinking):not(.expanded)::before,
.video-mask.animating:not(.shrinking):not(.expanded)::after {
  opacity: 0;
  animation: none;
}

.video-mask.expanded {
  animation: none;
  /* Hide the mask entirely once expanded to avoid any edge artifacts */
  visibility: hidden;
  background: transparent !important;
}

/* ============================================
   PORTAL STATE: COLD
   Queued/disconnected - grid void background
   ============================================ */

.video-mask.state-cold {
  animation: portalColdIdle 6s ease-in-out infinite;
}

.video-mask.state-cold::before {
  opacity: 0.15;
  animation: portalRingColorShiftSlow 20s linear infinite;
}

.video-mask.state-cold::after {
  opacity: 0.1;
  animation: portalRingColorShift 8s linear infinite;
}

/* Grid void background */
.portal-background-cold {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  overflow: hidden;
  background: #020617;

  /* Scanline fade controls */
  --scanline-speed: 4s;        /* Duration of one fade cycle */
  --scanline-bands: 3;         /* Number of fade bands visible at once */
  --scanline-intensity: 0.85;  /* How much lines fade (0 = no fade, 1 = full fade) */
  --scanline-softness: 30%;    /* Softness of fade bands (higher = softer) */
}

.portal-background-cold::before {
  content: '';
  position: absolute;
  top: 50%;
  left: 50%;
  width: 200%;
  height: 200%;
  transform: translate(-50%, -50%) perspective(500px) rotateX(60deg);
  /* Vertical lines only - no animation to avoid subpixel interference */
  background-image:
    linear-gradient(90deg, rgba(80, 200, 200, 0.15) 2px, transparent 2px);
  background-size: 6.25cqw 11.1cqh; /* 40px / 640px, 40px / 360px */
}

/* Scanline fade overlay - horizontal lines with wave fade effect */
.grid-scanlines {
  position: absolute;
  top: 50%;
  left: 50%;
  width: 200%;
  height: 200%;
  transform: translate(-50%, -50%) perspective(500px) rotateX(60deg);
  pointer-events: none;
  z-index: 1;
  /* Horizontal lines - 2px thick to avoid subpixel fading from perspective compression */
  background-image:
    linear-gradient(rgba(80, 200, 200, 0.15) 4px, transparent 4px);
  background-size: 6.25cqw 11.1cqh;
  /* Animated wave mask - fades bands of horizontal lines */
  -webkit-mask-image: repeating-linear-gradient(
    to bottom,
    white 0%,
    white calc(50% / var(--scanline-bands) - var(--scanline-softness) / 2),
    rgba(255, 255, 255, calc(1 - var(--scanline-intensity))) calc(50% / var(--scanline-bands)),
    white calc(50% / var(--scanline-bands) + var(--scanline-softness) / 2),
    white calc(100% / var(--scanline-bands))
  );
  mask-image: repeating-linear-gradient(
    to bottom,
    white 0%,
    white calc(50% / var(--scanline-bands) - var(--scanline-softness) / 2),
    rgba(255, 255, 255, calc(1 - var(--scanline-intensity))) calc(50% / var(--scanline-bands)),
    white calc(50% / var(--scanline-bands) + var(--scanline-softness) / 2),
    white calc(100% / var(--scanline-bands))
  );
  -webkit-mask-size: 100% calc(100% / var(--scanline-bands));
  mask-size: 100% calc(100% / var(--scanline-bands));
  animation:
    gridDrift 6s linear infinite,
    scanlineWave var(--scanline-speed) linear infinite;
}

@keyframes scanlineWave {
  0% {
    -webkit-mask-position: 0 0;
    mask-position: 0 0;
  }
  100% {
    -webkit-mask-position: 0 calc(100% / var(--scanline-bands));
    mask-position: 0 calc(100% / var(--scanline-bands));
  }
}

.portal-background-cold::after {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  z-index: 2;
  background: radial-gradient(
    ellipse 50% 50% at 50% 50%,
    transparent 0%,
    rgba(2, 6, 23, 0.7) 50%,
    #020617 80%
  );
}

@keyframes gridDrift {
  0% {
    background-position: 0 0, 0 0;
  }
  100% {
    background-position: 0 11.1cqh, 0 11.1cqh; /* Match background-size */
  }
}

@keyframes scanlineFade {
  0% {
    --scanline-phase: 0%;
  }
  100% {
    --scanline-phase: 100%;
  }
}

@property --scanline-phase {
  syntax: '<percentage>';
  inherits: true;
  initial-value: 0%;
}

/* ============================================
   PORTAL STATE: WARM
   Connecting - hyperspace data stream
   ============================================ */

.video-mask.state-warm {
  /* Shudder plays once (0.6s), then idle loops forever */
  animation:
    portalShudder 0.6s ease-out 1,
    portalWarmIdle 3s ease-in-out 0.6s infinite;
}

.video-mask.state-warm::before {
  opacity: 0.35;
  animation: portalRingColorShiftSlow 10s linear infinite;
}

.video-mask.state-warm::after {
  opacity: 0.25;
  animation: portalRingColorShift 3s linear infinite;
}

/* Hyperspace tunnel background */
.portal-background-warm {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  overflow: hidden;
  background:
    radial-gradient(
      ellipse 30% 40% at 50% 50%,
      rgba(40, 60, 100, 0.5) 0%,
      rgba(20, 35, 60, 0.4) 30%,
      rgba(10, 20, 40, 0.2) 60%,
      transparent 100%
    ),
    radial-gradient(
      ellipse 60% 70% at 50% 50%,
      #0a1628 0%,
      #050d1a 40%,
      #020617 100%
    );
}

/* Tunnel rings container */
.tunnel-rings {
  position: absolute;
  top: 50%;
  left: 50%;
  width: 62.5cqw; /* 400px / 640px */
  height: 133cqh; /* 480px / 360px */
  transform: translate(-50%, -50%);
}

/* Individual tunnel ring - starts small at center, expands outward */
.tunnel-ring {
  position: absolute;
  top: 50%;
  left: 50%;
  width: 100%;
  height: 100%;
  border: 1px solid rgba(100, 160, 220, 0.4);
  border-radius: 50%;
  transform: translate(-50%, -50%) scale(0);
  opacity: 0;
  animation: ringExpand 2s linear infinite;
}

@keyframes ringExpand {
  0% {
    transform: translate(-50%, -50%) scale(0.02);
    opacity: 0;
    border-width: 1px;
  }
  10% {
    opacity: 0.6;
  }
  50% {
    opacity: 0.3;
  }
  100% {
    transform: translate(-50%, -50%) scale(1);
    opacity: 0;
    border-width: 2px;
  }
}

/* Stagger ring animations */
.tunnel-ring:nth-child(1) { animation-delay: 0s; }
.tunnel-ring:nth-child(2) { animation-delay: -0.33s; }
.tunnel-ring:nth-child(3) { animation-delay: -0.66s; }
.tunnel-ring:nth-child(4) { animation-delay: -1s; }
.tunnel-ring:nth-child(5) { animation-delay: -1.33s; }
.tunnel-ring:nth-child(6) { animation-delay: -1.66s; }

/* Vignette overlay for depth */
.portal-background-warm::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: radial-gradient(
    ellipse 50% 60% at 50% 50%,
    transparent 0%,
    transparent 20%,
    rgba(2, 6, 23, 0.6) 60%,
    #020617 100%
  );
  pointer-events: none;
  z-index: 25;
}

/* Center glow */
.warp-center {
  position: absolute;
  top: 50%;
  left: 50%;
  width: 1cqw; /* 6px / 640px */
  height: 1.67cqh; /* 6px / 360px */
  transform: translate(-50%, -50%);
  background: radial-gradient(
    circle at center,
    rgba(255, 255, 255, 1) 0%,
    rgba(200, 240, 255, 0.5) 50%,
    transparent 100%
  );
  border-radius: 50%;
  animation: warpPulse 1.5s ease-in-out infinite;
}

@keyframes warpPulse {
  0%, 100% { transform: translate(-50%, -50%) scale(1); opacity: 0.8; }
  50% { transform: translate(-50%, -50%) scale(1.3); opacity: 1; }
}

/* Individual star streaks with depth layers */
.streak {
  position: absolute;
  top: 50%;
  left: 50%;
  width: var(--thickness, 0.3cqw);
  height: 0;
  background: linear-gradient(
    to bottom,
    transparent 0%,
    var(--color-mid) 20%,
    var(--color-core) 50%,
    var(--color-mid) 80%,
    transparent 100%
  );
  transform-origin: top center;
  opacity: 0;
  animation: streakFly var(--speed) linear infinite;
  --color-core: rgba(255, 255, 255, var(--brightness, 1));
  --color-mid: rgba(180, 220, 255, var(--brightness, 0.8));
  --travel: 55cqh; /* 200px / 360px */
}

@keyframes streakFly {
  0% {
    height: 0;
    opacity: 0;
    transform: translate(-50%, 0) rotate(var(--angle)) translateY(10px);
  }
  10% {
    opacity: var(--brightness, 1);
  }
  50% {
    height: var(--length);
    opacity: var(--brightness, 1);
  }
  100% {
    height: var(--length);
    opacity: 0;
    transform: translate(-50%, 0) rotate(var(--angle)) translateY(var(--travel));
  }
}

/* FAR layer - dim, thin, slow, short travel */
.streak-far {
  --thickness: 0.15cqw; /* 1px / 640px */
  --brightness: 0.3;
  --travel: 22cqh; /* 80px / 360px */
}

.streak-1  { --angle: 8deg;   --length: 7cqh;  --speed: 2.8s; animation-delay: 0s; }
.streak-2  { --angle: 37deg;  --length: 8.3cqh;  --speed: 2.5s; animation-delay: -0.4s; }
.streak-3  { --angle: 66deg;  --length: 6.1cqh;  --speed: 3.0s; animation-delay: -1.0s; }
.streak-4  { --angle: 95deg;  --length: 7.8cqh;  --speed: 2.6s; animation-delay: -0.7s; }
.streak-5  { --angle: 124deg; --length: 8.9cqh;  --speed: 2.4s; animation-delay: -1.5s; }
.streak-6  { --angle: 153deg; --length: 7.2cqh;  --speed: 2.7s; animation-delay: -0.2s; }
.streak-7  { --angle: 182deg; --length: 9.7cqh;  --speed: 2.3s; animation-delay: -1.8s; }
.streak-8  { --angle: 211deg; --length: 6.7cqh;  --speed: 2.9s; animation-delay: -0.9s; }
.streak-9  { --angle: 240deg; --length: 8.1cqh;  --speed: 2.5s; animation-delay: -1.3s; }
.streak-10 { --angle: 269deg; --length: 7.5cqh;  --speed: 2.6s; animation-delay: -0.5s; }
.streak-11 { --angle: 298deg; --length: 8.6cqh;  --speed: 2.4s; animation-delay: -1.6s; }
.streak-12 { --angle: 327deg; --length: 6.4cqh;  --speed: 2.8s; animation-delay: -0.1s; }

/* MID layer - medium brightness, thickness, speed */
.streak-mid {
  --thickness: 0.3cqw; /* 2px / 640px */
  --brightness: 0.6;
  --travel: 42cqh; /* 150px / 360px */
}

.streak-13 { --angle: 20deg;  --length: 14cqh;  --speed: 1.6s; animation-delay: -0.2s; }
.streak-14 { --angle: 56deg;  --length: 16.7cqh;  --speed: 1.4s; animation-delay: -0.7s; }
.streak-15 { --angle: 92deg;  --length: 12.5cqh;  --speed: 1.7s; animation-delay: -1.1s; }
.streak-16 { --angle: 128deg; --length: 15.3cqh;  --speed: 1.5s; animation-delay: -0.4s; }
.streak-17 { --angle: 164deg; --length: 18.1cqh;  --speed: 1.3s; animation-delay: -0.9s; }
.streak-18 { --angle: 200deg; --length: 13.3cqh;  --speed: 1.6s; animation-delay: -1.4s; }
.streak-19 { --angle: 236deg; --length: 16.1cqh;  --speed: 1.4s; animation-delay: -0.1s; }
.streak-20 { --angle: 272deg; --length: 14.4cqh;  --speed: 1.5s; animation-delay: -0.6s; }
.streak-21 { --angle: 308deg; --length: 17.2cqh;  --speed: 1.3s; animation-delay: -1.0s; }
.streak-22 { --angle: 344deg; --length: 13.1cqh;  --speed: 1.6s; animation-delay: -0.3s; }

/* NEAR layer - bright, thick, fast, long travel */
.streak-near {
  --thickness: 0.47cqw; /* 3px / 640px */
  --brightness: 1;
  --travel: 69cqh; /* 250px / 360px */
}

.streak-23 { --angle: 15deg;  --length: 26cqh;  --speed: 0.75s; animation-delay: -0.1s; }
.streak-24 { --angle: 63deg;  --length: 29cqh; --speed: 0.65s; animation-delay: -0.35s; }
.streak-25 { --angle: 111deg; --length: 24cqh;  --speed: 0.8s;  animation-delay: -0.5s; }
.streak-26 { --angle: 159deg; --length: 31cqh; --speed: 0.6s;  animation-delay: -0.2s; }
.streak-27 { --angle: 207deg; --length: 25cqh;  --speed: 0.7s;  animation-delay: -0.45s; }
.streak-28 { --angle: 255deg; --length: 28cqh; --speed: 0.68s; animation-delay: -0.15s; }
.streak-29 { --angle: 303deg; --length: 24cqh;  --speed: 0.78s; animation-delay: -0.4s; }
.streak-30 { --angle: 351deg; --length: 27cqh;  --speed: 0.72s; animation-delay: -0.25s; }

/* ============================================
   PORTAL STATE: HOT
   Connected - burst/flash transition
   ============================================ */

.video-mask.state-hot::before {
  opacity: 0.6;
  animation: portalRingColorShiftSlow 4s linear infinite;
}

.video-mask.state-hot::after {
  opacity: 0.5;
  animation: portalRingColorShift 0.8s linear infinite;
}

/* Hide ring once fully expanded */
.video-mask.state-hot.expanded::before,
.video-mask.state-hot.expanded::after {
  opacity: 0;
  animation: none;
}

.portal-background-hot {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  overflow: hidden;
  background: #020617;
}

.portal-background-hot.flash {
  animation: portalFlash 0.6s ease-out forwards;
}

.portal-background-hot::before {
  content: '';
  position: absolute;
  top: 50%;
  left: 50%;
  width: 100%;
  height: 100%;
  transform: translate(-50%, -50%);
  background: radial-gradient(
    ellipse 50% 60% at 50% 50%,
    rgba(200, 255, 255, 1) 0%,
    rgba(100, 200, 255, 0.8) 20%,
    rgba(50, 150, 255, 0.4) 40%,
    transparent 70%
  );
}

@keyframes portalFlash {
  0% {
    opacity: 0;
    transform: scale(0.5);
  }
  20% {
    opacity: 1;
    transform: scale(1.2);
  }
  100% {
    opacity: 0;
    transform: scale(2);
  }
}

/* ============================================
   SHUTDOWN: TV Turn-off Effect
   Vintage CRT television power-off animation
   ============================================ */

.shutdown-overlay {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  pointer-events: none;
  z-index: 1000;
  opacity: 0;
  visibility: hidden;
  overflow: hidden;
  /* Solid black base - nothing shows through */
  background: #020617;
}

.shutdown-overlay.active {
  opacity: 1;
  visibility: visible;
  pointer-events: all; /* Block interaction during animation */
}

/* Animated black background layer (starts slightly transparent for flash effect) */
.shutdown-overlay .shutdown-background {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: #020617;
  opacity: 0;
  z-index: 1;
}

.shutdown-overlay.active .shutdown-background {
  animation: tvBlackout 1s ease-out forwards;
}

/* White flash layer - full coverage */
.shutdown-overlay::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: white;
  opacity: 0;
  z-index: 2;
}

.shutdown-overlay.active::before {
  animation: tvFlash 1s ease-out forwards;
}

/* Horizontal line (the classic CRT collapse) */
.shutdown-overlay::after {
  content: '';
  position: absolute;
  top: 50%;
  left: 50%;
  width: 100%;
  height: 4px;
  transform: translate(-50%, -50%) scaleX(1);
  background: white;
  box-shadow:
    0 0 20px 10px rgba(255, 255, 255, 0.8),
    0 0 40px 20px rgba(200, 255, 255, 0.4);
  opacity: 0;
  z-index: 3;
}

.shutdown-overlay.active::after {
  animation: tvLine 1s ease-out forwards;
}

@keyframes tvFlash {
  0% {
    opacity: 0;
  }
  8% {
    opacity: 1;
  }
  20% {
    opacity: 0.6;
  }
  35% {
    opacity: 0;
  }
  100% {
    opacity: 0;
  }
}

@keyframes tvLine {
  0% {
    opacity: 0;
    transform: translate(-50%, -50%) scaleX(1) scaleY(100);
  }
  15% {
    opacity: 1;
    transform: translate(-50%, -50%) scaleX(1) scaleY(80);
  }
  35% {
    opacity: 1;
    transform: translate(-50%, -50%) scaleX(1) scaleY(1);
  }
  60% {
    opacity: 1;
    transform: translate(-50%, -50%) scaleX(0.6) scaleY(1);
  }
  80% {
    opacity: 0.8;
    transform: translate(-50%, -50%) scaleX(0.15) scaleY(1);
  }
  100% {
    opacity: 0;
    transform: translate(-50%, -50%) scaleX(0) scaleY(0);
  }
}

@keyframes tvBlackout {
  0% {
    opacity: 0;
  }
  25% {
    opacity: 0.3;
  }
  50% {
    opacity: 0.7;
  }
  100% {
    opacity: 1;
  }
}
